{% extends 'blog/web-admin/admin-base.html' %}

{% block admin-content %}
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">
        <h1 class="h2">Berita</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group mr-2">
                <a href="{% url 'admin_berita_add' %}" class="btn btn-primary btn-sm">Tambah Berita</a>
            </div>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-striped table-sm">
            <thead>
                <tr>
                    <th>Judul Berita</th>
                    <th class="text-center">Kategori</th>
                    <th class="text-center">Tanggal Berita</th>
                    <th class="text-center">Author</th>
                    {% if request.user.is_staff %}
                    <th class="text-center">Status</th>
                    <th class="text-center">Featured</th>
                    {% endif %}
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                <tr>
                    <td>{{ post.title|truncatechars:40 }}</td>
                    <td class="text-center">{% if post.category %}{{ post.category }}{% else %}-{% endif %}</td>
                    <td class="text-center">{{ post.updated_at|date:"d/m/Y, g:ia" }}</td>
                    <td class="text-center">{{ post.author.get_full_name }}</td>
                    {% if request.user.is_staff %}
                    <td class="text-center">{{ post.status_verbose }}</td>
                    <td class="text-center">{% if post.featured %}<span data-feather="check-circle" style="color:green"></span>{% endif %}</td>
                    {% endif %}
                    <td>
                        <button class="float-right ml-1 btn btn-sm btn-danger" data-toggle="modal" data-target="#hapusPost{{ post.id }}">Delete</button>
                        <!-- Delete Modal -->
                        <div class="modal fade" id="hapusPost{{ post.id }}" tabindex="-1" role="dialog" aria-labelledby="hapusPost{{ post.id }}Title"
                            aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <form method="POST" action="{% url 'admin_berita_hapus' post_id=post.id %}">
                                        {% csrf_token %}
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="hapusPost{{ post.id }}LongTitle">Konfirmasi Hapus Berita</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <p>Kamu yakin ingin menghapus berita ini?</p>
                                            <p><strong>{{ post.title }}</strong></p>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
                                            <input type="submit" class="btn btn-danger" name="confirm-delete" value="Hapus Berita">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <a href="{% url 'admin_berita_update' post_id=post.id %}" class="float-right btn btn-sm btn-success">Edit</a>
                        <a href="{% url 'post_detail' slug=post.slug %}" class="float-right mr-1 btn btn-sm btn-warning" target="_blank">Prantinjau</a>
                        {% if request.user.is_staff and post.post_status == 'draft' %}
                        <button class="float-right mr-1 btn btn-sm btn-primary" data-toggle="modal"
                            data-target="#publishPost{{ post.id }}">Terbitkan</button>
                        <!-- Publish Modal -->
                        <div class="modal fade" id="publishPost{{ post.id }}" tabindex="-1" role="dialog"
                            aria-labelledby="publishPost{{ post.id }}Title" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                    <form method="POST" action="{% url 'admin_berita_publish' post_id=post.id %}">
                                        {% csrf_token %}
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="publishPost{{ post.id }}LongTitle">Konfirmasi Terbitkan Berita</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <p>Kamu yakin ingin menerbitkan berita ini?</p>
                                            <p><strong>{{ post.title }}</strong></p>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
                                            <input type="submit" class="btn btn-primary" name="confirm-publish" value="Terbitkan Berita">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock admin-content %}